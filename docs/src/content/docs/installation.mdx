---
title: Installation & Setup
description: Deploy UseCallManager security services with Docker Compose
---

import { Card, CardGrid, Aside, Steps, Badge } from '@astrojs/starlight/components';

<Aside type="caution">
**⚠️ This page has been reorganized**

This content has been split into focused task-oriented guides following the Diátaxis documentation framework:

**Installation:**
- [Deploy with Docker Compose](/how-to/installation/deploy-docker/) - Step-by-step deployment
- [Configure Environment](/how-to/installation/configure-environment/) - Environment variables and settings
- [Backup & Restore](/how-to/installation/backup-restore/) - Data protection and recovery

**Certificate Management:**
- [Upload Certificates to TVS](/how-to/certificates/upload-to-tvs/) - Server certificate upload
- [Generate CAPF Issuer Certificate](/how-to/certificates/generate-issuer/) - Create issuer CA
- [Renew Expiring Certificates](/how-to/certificates/renew-certificates/) - Certificate lifecycle

**Phone Setup:**
- [Enroll Phone with LSC](/how-to/phone/enroll-lsc/) - Device enrollment process

**Complete Tutorial:**
- [Your First Phone Deployment](/tutorials/first-deployment/) - End-to-end beginner guide

This page will remain temporarily for reference but will be removed in the future. Please use the focused guides above.
</Aside>

# Installation & Setup

UseCallManager security services are deployed using Docker Compose for easy setup and management.

## Prerequisites

<Aside type="note">
Ensure you have the following requirements before starting the installation.
</Aside>

- Docker Engine <Badge text="20.10+" variant="tip" />
- Docker Compose V2
- Domain name with DNS configured (for TLS certificates)
- Caddy reverse proxy (for HTTPS termination)

## Quick Start

<Steps>

1. **Clone the Repository**

   ```bash
   git clone https://github.com/rsp2k/usecallmanager-daemons.git
   cd usecallmanager-daemons
   ```

2. **Configure Environment**

   Create a `.env` file:

   ```bash
   # Project name (prevents namespace conflicts)
   COMPOSE_PROJECT=usecallmanager

   # Domain configuration
   DOMAIN=usecallmanager-services.example.com

   # Database (optional, defaults to SQLite)
   # CAPF_DATABASE_URL=postgresql://user:pass@localhost/capf
   # TVS_DATABASE_URL=postgresql://user:pass@localhost/tvs
   ```

3. **Start Services**

   ```bash
   docker compose up -d
   ```

   This starts:
   <CardGrid>
     <Card title="CAPF" icon="document">
       - Port <Badge text="3804" variant="note" /> (protocol)
       - Port <Badge text="8082" variant="tip" /> (API)
     </Card>
     <Card title="TVS" icon="approve-check">
       - Port <Badge text="8081" variant="tip" /> (API)
     </Card>
     <Card title="Frontend" icon="laptop">
       - Port <Badge text="4321" variant="tip" /> (web UI)
     </Card>
     <Card title="Caddy" icon="rocket">
       - Reverse proxy with automatic HTTPS
     </Card>
   </CardGrid>

4. **Verify Services**

   Check health endpoints:

   ```bash
   curl https://$DOMAIN/api/capf/api/v1/health
   curl https://$DOMAIN/api/tvs/api/v1/health
   ```

   Expected response:
   ```json
   {
     "status": "healthy",
     "version": "4.0.0",
     "database": "connected"
   }
   ```

</Steps>

## Configuration

### CAPF Settings

Environment variables for CAPF service:

| Variable | Default | Description |
|----------|---------|-------------|
| `CAPF_PROTOCOL_PORT` | `3804` | CAPF protocol port for phones |
| `CAPF_API_PORT` | `8082` | REST API port |
| `CAPF_DATABASE_URL` | `sqlite:///var/lib/capf/capf.sqlite3` | Database connection string |
| `CAPF_CERT_DIR` | `/var/lib/capf/certificates` | Certificate storage directory |
| `CAPF_KEY_SIZE` | `2048` | Default RSA key size for issuer |

### TVS Settings

Environment variables for TVS service:

| Variable | Default | Description |
|----------|---------|-------------|
| `TVS_API_PORT` | `8081` | REST API port |
| `TVS_DATABASE_URL` | `sqlite:///var/lib/tvs/tvs.sqlite3` | Database connection string |

### Caddy Reverse Proxy

The `docker-compose.yml` includes Caddy labels for automatic reverse proxy configuration:

```yaml
services:
  frontend:
    labels:
      caddy: ${DOMAIN}
      caddy.reverse_proxy: "{{upstreams 4321}}"
```

Services are automatically available at:
- Frontend: `https://$DOMAIN/`
- CAPF API: `https://$DOMAIN/api/capf/`
- TVS API: `https://$DOMAIN/api/tvs/`

## Initial Setup

<Aside type="tip">
After starting the services, you'll need to generate the CAPF issuer certificate before enrolling devices.
</Aside>

### Generate Issuer Certificate

<Steps>

1. Navigate to **Issuer Certificate** page in the web UI

2. Click **Generate New Issuer Certificate**

3. Configure the certificate:
   - Common Name: `CAPF-SAST` (or your preferred name)
   - Organization: `UseCallManager`
   - Country: `NZ` (or your country code)
   - Key Type: RSA 2048-bit (recommended)
   - Validity: 10 years

</Steps>

<Aside type="note">
The issuer certificate is used to sign device certificates (LSCs) and must be generated before you can enroll any phones.
</Aside>

## Persistence

Data is stored in Docker volumes:

```bash
# View volumes
docker volume ls | grep usecallmanager

# Backup volumes
docker run --rm -v usecallmanager_capf-data:/data \
  -v $(pwd):/backup alpine \
  tar czf /backup/capf-backup.tar.gz -C /data .
```

<Aside type="caution">
Regular backups are recommended! Store backups in a secure location separate from your production system.
</Aside>

## Troubleshooting

### Check Logs

<Aside>
Logs are your first stop when diagnosing issues. Check service-specific logs to narrow down problems.
</Aside>

```bash
# All services
docker compose logs -f

# Specific service
docker compose logs -f capf
docker compose logs -f tvs
docker compose logs -f frontend
```

### Database Connection Issues

If using PostgreSQL, ensure the database exists:

```bash
createdb -U postgres capf
createdb -U postgres tvs
```

<Aside type="danger">
SQLite is suitable for development and small deployments. For production environments with many devices, use PostgreSQL.
</Aside>

### Port Conflicts

If ports <Badge text="3804" variant="note" />, <Badge text="8081" variant="tip" />, <Badge text="8082" variant="tip" />, or <Badge text="4321" variant="tip" /> are in use, modify `docker-compose.yml` to use different ports.

### Certificate Issues

If Caddy cannot obtain certificates, check:
- DNS is correctly configured
- Port <Badge text="443" variant="caution" /> is accessible from the internet
- Domain ownership verification

<Aside type="tip">
Use `docker compose logs caddy` to view certificate acquisition status and troubleshoot Let's Encrypt issues.
</Aside>
